TOC
* [Main](index.md)
* [Features](01_features.md)
* [Configuration](02_configuration.md)
* [Wiring](03_wiring.md)
* [NodeRED MQTT Example](04_nodered_example.md)
* [Home Assistant Example](05_homeassistant_example.md)
* [FAQ & Troubleshooting](09_faq.md)


# NodeRED Example
These examples show how to interface ratgdo to Apple's HomeKit using the [NRCHKB](https://nrchkb.github.io) homekit node for [NodeRED](https://nodered.org). The process for Google Home would be similar - if anyone wishes to share an example, please submit a pull request.


## Single Door with Reed Switch
This is the most basic setup with a single garage door using a [reed switch](03_wiring_solder_free.md) to detect if the door is open or closed.

```json
[{"id":"eac1734e27399ccb","type":"switch","z":"6ba85b54.4eaccc","name":"reed switch","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"reed_closed","vt":"str"},{"t":"eq","v":"reed_opened","vt":"str"},{"t":"eq","v":"obstructed","vt":"str"},{"t":"eq","v":"clear","vt":"str"},{"t":"eq","v":"online","vt":"str"},{"t":"eq","v":"offline","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":710,"y":2000,"wires":[["201fb54fc209c02e"],["a239d92c5e1beabc"],["e53a75e60cb1a491"],["35516d6ed099e49e"],[],[]]},{"id":"e662f4b7c588bba2","type":"inject","z":"6ba85b54.4eaccc","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"reed_opened","payloadType":"str","x":490,"y":1940,"wires":[["eac1734e27399ccb"]]},{"id":"4094cfe274bad011","type":"inject","z":"6ba85b54.4eaccc","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"reed_closed","payloadType":"str","x":490,"y":1980,"wires":[["eac1734e27399ccb"]]},{"id":"d583c608317678aa","type":"inject","z":"6ba85b54.4eaccc","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"offline","payloadType":"str","x":470,"y":2060,"wires":[["eac1734e27399ccb"]]},{"id":"889d1f5698c08507","type":"inject","z":"6ba85b54.4eaccc","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"online","payloadType":"str","x":470,"y":2100,"wires":[["eac1734e27399ccb"]]},{"id":"201fb54fc209c02e","type":"change","z":"6ba85b54.4eaccc","name":"CurrentDoorState Open","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"TargetDoorState\":0,\"CurrentDoorState\":0}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":970,"y":1940,"wires":[["38540ebc9f1935b6"]]},{"id":"a239d92c5e1beabc","type":"change","z":"6ba85b54.4eaccc","name":"CurrentDoorState Closed","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"TargetDoorState\":1,\"CurrentDoorState\":1}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":970,"y":1980,"wires":[["38540ebc9f1935b6"]]},{"id":"e53a75e60cb1a491","type":"change","z":"6ba85b54.4eaccc","name":"Obstruction","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"ObstructionDetected\":true}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":2020,"wires":[["38540ebc9f1935b6"]]},{"id":"35516d6ed099e49e","type":"change","z":"6ba85b54.4eaccc","name":"Clear","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"ObstructionDetected\":false}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":910,"y":2060,"wires":[["38540ebc9f1935b6"]]},{"id":"38540ebc9f1935b6","type":"homekit-service","z":"6ba85b54.4eaccc","isParent":true,"hostType":"0","bridge":"5848fa57.3c3164","accessoryId":"","parentService":"","name":"Glass Door","serviceName":"GarageDoorOpener","topic":"home/garage/ReedDoor/status","filter":true,"manufacturer":"prw","model":"1337","serialNo":"001","firmwareRev":"1337","hardwareRev":"1337","softwareRev":"1337","cameraConfigVideoProcessor":"ffmpeg","cameraConfigSource":"","cameraConfigStillImageSource":"","cameraConfigMaxStreams":2,"cameraConfigMaxWidth":1280,"cameraConfigMaxHeight":720,"cameraConfigMaxFPS":10,"cameraConfigMaxBitrate":300,"cameraConfigVideoCodec":"libx264","cameraConfigAudioCodec":"libfdk_aac","cameraConfigAudio":false,"cameraConfigPacketSize":1316,"cameraConfigVerticalFlip":false,"cameraConfigHorizontalFlip":false,"cameraConfigMapVideo":"0:0","cameraConfigMapAudio":"0:1","cameraConfigVideoFilter":"scale=1280:720","cameraConfigAdditionalCommandLine":"-tune zerolatency","cameraConfigDebug":false,"cameraConfigSnapshotOutput":"disabled","cameraConfigInterfaceName":"","characteristicProperties":"{}","waitForSetupMsg":false,"outputs":2,"x":1250,"y":1980,"wires":[["38d8dd804862d23f"],[]]},{"id":"7632c096afee3363","type":"mqtt in","z":"6ba85b54.4eaccc","name":"","topic":"home/garage/GlassDoor/status","qos":"2","datatype":"auto","broker":"a59c4793.670798","nl":false,"rap":true,"rh":0,"inputs":0,"x":430,"y":2020,"wires":[["eac1734e27399ccb"]]},{"id":"fd17fd5892bba86d","type":"mqtt out","z":"6ba85b54.4eaccc","name":"","topic":"home/garage/GlassDoor/command","qos":"2","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"a59c4793.670798","x":1800,"y":2000,"wires":[]},{"id":"bd281e85a2f39daf","type":"change","z":"6ba85b54.4eaccc","name":"close","rules":[{"t":"set","p":"payload","pt":"msg","to":"close","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1550,"y":1960,"wires":[["fd17fd5892bba86d","f3cae6bdd63c7bbc"]]},{"id":"302078df8509c3c6","type":"change","z":"6ba85b54.4eaccc","name":"open","rules":[{"t":"set","p":"payload","pt":"msg","to":"open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1550,"y":2000,"wires":[["fd17fd5892bba86d","f3cae6bdd63c7bbc"]]},{"id":"f3cae6bdd63c7bbc","type":"debug","z":"6ba85b54.4eaccc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1730,"y":1960,"wires":[]},{"id":"38d8dd804862d23f","type":"switch","z":"6ba85b54.4eaccc","name":"","property":"payload.TargetDoorState","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1410,"y":1980,"wires":[["bd281e85a2f39daf"],["302078df8509c3c6"]]},{"id":"1cc896f5d19f730d","type":"inject","z":"6ba85b54.4eaccc","name":"Toggle Light","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"light","payloadType":"str","x":1530,"y":2040,"wires":[["fd17fd5892bba86d"]]},{"id":"4d46b5399b6abf63","type":"inject","z":"6ba85b54.4eaccc","name":"Query on Startup","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"query","payloadType":"str","x":510,"y":1900,"wires":[["bc8fe12ef3851398"]]},{"id":"bc8fe12ef3851398","type":"mqtt out","z":"6ba85b54.4eaccc","name":"","topic":"home/garage/GlassDoor/command","qos":"2","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"a59c4793.670798","x":760,"y":1900,"wires":[]},{"id":"5848fa57.3c3164","type":"homekit-bridge","bridgeName":"NodeRed","pinCode":"111-11-112","port":"","allowInsecureRequest":false,"manufacturer":"NRCHKB","model":"1.2.0","serialNo":"Default Serial Number","firmwareRev":"1.2.0","hardwareRev":"1.2.0","softwareRev":"1.2.0","customMdnsConfig":false,"mdnsMulticast":true,"mdnsInterface":"","mdnsPort":"","mdnsIp":"","mdnsTtl":"","mdnsLoopback":true,"mdnsReuseAddr":true,"allowMessagePassthrough":false},{"id":"a59c4793.670798","type":"mqtt-broker","name":"","broker":"10.0.1.55","port":"1883","clientid":"","autoConnect":true,"usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","birthMsg":{},"closeTopic":"","closeRetain":"false","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willRetain":"false","willPayload":"","willMsg":{},"sessionExpiry":""}]
```
<a href="https://user-images.githubusercontent.com/4663918/178538876-da15f6e7-872c-4911-820f-f0ddb237b35a.png">
  <img width="800px" alt="image" src="https://user-images.githubusercontent.com/4663918/178538876-da15f6e7-872c-4911-820f-f0ddb237b35a.png">
</a>

## Single Door with Rotary Encoder
This example works when using the door's [rotary encoder](03_wiring_soldered.md) which gives us more detailed status of the door's physical state.


``` json
[{"id":"f48ed15311a6296c","type":"mqtt in","z":"6ba85b54.4eaccc","name":"","topic":"home/garage/GlassDoor/status","qos":"2","datatype":"auto","broker":"a59c4793.670798","nl":false,"rap":true,"rh":0,"inputs":0,"x":430,"y":1600,"wires":[["5108a80ff9459063","989828a77562a82b"]]},{"id":"c987321cd4beb4b3","type":"change","z":"6ba85b54.4eaccc","name":"Obstruction","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"ObstructionDetected\":true}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":1640,"wires":[["3275c7259121f37e"]]},{"id":"aa6378b3dd29c764","type":"change","z":"6ba85b54.4eaccc","name":"Clear","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"ObstructionDetected\":false}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":970,"y":1680,"wires":[["3275c7259121f37e"]]},{"id":"5108a80ff9459063","type":"switch","z":"6ba85b54.4eaccc","name":"rotary encoder","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"opening","vt":"str"},{"t":"eq","v":"open","vt":"str"},{"t":"eq","v":"closing","vt":"str"},{"t":"eq","v":"closed","vt":"str"},{"t":"eq","v":"reed_opened","vt":"str"},{"t":"eq","v":"obstructed","vt":"str"},{"t":"eq","v":"clear","vt":"str"},{"t":"eq","v":"online","vt":"str"},{"t":"eq","v":"offline","vt":"str"}],"checkall":"true","repair":false,"outputs":9,"x":720,"y":1600,"wires":[["8d4c0e0df40c401d"],["59c9b9d40d4d8bcc"],["8891787beca2ebd9"],["50cf9b2482ba7e33"],["50cf9b2482ba7e33"],["c987321cd4beb4b3"],["aa6378b3dd29c764"],["074e2c6da3f17ffd"],["2e29e79ea8fae7db"]]},{"id":"59c9b9d40d4d8bcc","type":"change","z":"6ba85b54.4eaccc","name":"CurrentDoorState Open","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"TargetDoorState\":0,\"CurrentDoorState\":0}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":1520,"wires":[["3275c7259121f37e"]]},{"id":"50cf9b2482ba7e33","type":"change","z":"6ba85b54.4eaccc","name":"CurrentDoorState Closed","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"TargetDoorState\":1,\"CurrentDoorState\":1}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":1600,"wires":[["3275c7259121f37e"]]},{"id":"8d4c0e0df40c401d","type":"change","z":"6ba85b54.4eaccc","name":"CurrentDoorState Opening","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"TargetDoorState\":0,\"CurrentDoorState\":2}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":1480,"wires":[["3275c7259121f37e"]]},{"id":"8891787beca2ebd9","type":"change","z":"6ba85b54.4eaccc","name":"CurrentDoorState Closing","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"TargetDoorState\":1,\"CurrentDoorState\":3}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":1560,"wires":[["3275c7259121f37e"]]},{"id":"c2dc6ff0a3c4d8a3","type":"inject","z":"6ba85b54.4eaccc","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"closed","payloadType":"str","x":470,"y":1560,"wires":[["5108a80ff9459063"]]},{"id":"d1a16317b624e7a0","type":"inject","z":"6ba85b54.4eaccc","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"obstructed","payloadType":"str","x":480,"y":1520,"wires":[["5108a80ff9459063"]]},{"id":"e03fa57006c37811","type":"inject","z":"6ba85b54.4eaccc","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"open","payloadType":"str","x":470,"y":1480,"wires":[["5108a80ff9459063"]]},{"id":"b1cd991a847c9f62","type":"inject","z":"6ba85b54.4eaccc","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"closing","payloadType":"str","x":470,"y":1660,"wires":[["5108a80ff9459063"]]},{"id":"11cf42fa059b1912","type":"inject","z":"6ba85b54.4eaccc","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"opening","payloadType":"str","x":480,"y":1700,"wires":[["5108a80ff9459063"]]},{"id":"df947e5ec2f15bfa","type":"inject","z":"6ba85b54.4eaccc","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"clear","payloadType":"str","x":470,"y":1440,"wires":[["5108a80ff9459063"]]},{"id":"e36bb705171c9aa9","type":"mqtt out","z":"6ba85b54.4eaccc","name":"","topic":"home/garage/GlassDoor/command","qos":"2","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"a59c4793.670798","x":1820,"y":1560,"wires":[]},{"id":"989828a77562a82b","type":"debug","z":"6ba85b54.4eaccc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":730,"y":1700,"wires":[]},{"id":"887c79f10b308cbe","type":"inject","z":"6ba85b54.4eaccc","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"offline","payloadType":"str","x":470,"y":1740,"wires":[["5108a80ff9459063"]]},{"id":"b67be8acb0d520e7","type":"change","z":"6ba85b54.4eaccc","name":"close","rules":[{"t":"set","p":"payload","pt":"msg","to":"close","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1570,"y":1520,"wires":[["e36bb705171c9aa9","675a3df928cce059"]]},{"id":"92f324401455b6cd","type":"change","z":"6ba85b54.4eaccc","name":"open","rules":[{"t":"set","p":"payload","pt":"msg","to":"open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1570,"y":1560,"wires":[["e36bb705171c9aa9","675a3df928cce059"]]},{"id":"2e29e79ea8fae7db","type":"change","z":"6ba85b54.4eaccc","d":true,"name":"No Response","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"Name\": \"NO_RESPONSE\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":1760,"wires":[[]]},{"id":"719382012ea99a2b","type":"inject","z":"6ba85b54.4eaccc","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"online","payloadType":"str","x":470,"y":1780,"wires":[["5108a80ff9459063"]]},{"id":"074e2c6da3f17ffd","type":"change","z":"6ba85b54.4eaccc","d":true,"name":"Response?","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"Name\":\"Glass Door\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":1720,"wires":[[]]},{"id":"675a3df928cce059","type":"debug","z":"6ba85b54.4eaccc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1750,"y":1520,"wires":[]},{"id":"3275c7259121f37e","type":"homekit-service","z":"6ba85b54.4eaccc","isParent":true,"hostType":"0","bridge":"5848fa57.3c3164","accessoryId":"","parentService":"","name":"Glass Door","serviceName":"GarageDoorOpener","topic":"home/garage/GlassDoor/status","filter":true,"manufacturer":"prw","model":"1337","serialNo":"001","firmwareRev":"1337","hardwareRev":"1337","softwareRev":"1337","cameraConfigVideoProcessor":"ffmpeg","cameraConfigSource":"","cameraConfigStillImageSource":"","cameraConfigMaxStreams":2,"cameraConfigMaxWidth":1280,"cameraConfigMaxHeight":720,"cameraConfigMaxFPS":10,"cameraConfigMaxBitrate":300,"cameraConfigVideoCodec":"libx264","cameraConfigAudioCodec":"libfdk_aac","cameraConfigAudio":false,"cameraConfigPacketSize":1316,"cameraConfigVerticalFlip":false,"cameraConfigHorizontalFlip":false,"cameraConfigMapVideo":"0:0","cameraConfigMapAudio":"0:1","cameraConfigVideoFilter":"scale=1280:720","cameraConfigAdditionalCommandLine":"-tune zerolatency","cameraConfigDebug":false,"cameraConfigSnapshotOutput":"disabled","cameraConfigInterfaceName":"","characteristicProperties":"{}","waitForSetupMsg":false,"outputs":2,"x":1270,"y":1540,"wires":[["b86a2d121f196f2d"],[]]},{"id":"b86a2d121f196f2d","type":"switch","z":"6ba85b54.4eaccc","name":"","property":"payload.TargetDoorState","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1430,"y":1540,"wires":[["b67be8acb0d520e7"],["92f324401455b6cd"]]},{"id":"6e425593808d4fcd","type":"inject","z":"6ba85b54.4eaccc","name":"Toggle Light","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"light","payloadType":"str","x":1550,"y":1600,"wires":[["e36bb705171c9aa9"]]},{"id":"72cc6fdcdc5ad0fa","type":"inject","z":"6ba85b54.4eaccc","name":"Query on Startup","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"query","payloadType":"str","x":510,"y":1380,"wires":[["5c5f3744bcf3cba3"]]},{"id":"5c5f3744bcf3cba3","type":"mqtt out","z":"6ba85b54.4eaccc","name":"","topic":"home/garage/GlassDoor/command","qos":"2","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"a59c4793.670798","x":760,"y":1380,"wires":[]},{"id":"a59c4793.670798","type":"mqtt-broker","name":"","broker":"10.0.1.55","port":"1883","clientid":"","autoConnect":true,"usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","birthMsg":{},"closeTopic":"","closeRetain":"false","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willRetain":"false","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"5848fa57.3c3164","type":"homekit-bridge","bridgeName":"NodeRed","pinCode":"111-11-112","port":"","allowInsecureRequest":false,"manufacturer":"NRCHKB","model":"1.2.0","serialNo":"Default Serial Number","firmwareRev":"1.2.0","hardwareRev":"1.2.0","softwareRev":"1.2.0","customMdnsConfig":false,"mdnsMulticast":true,"mdnsInterface":"","mdnsPort":"","mdnsIp":"","mdnsTtl":"","mdnsLoopback":true,"mdnsReuseAddr":true,"allowMessagePassthrough":false}]
```

<a href="https://user-images.githubusercontent.com/4663918/178540643-ea54452b-f9e6-4d08-bcfc-44a5af5ba0b3.png">
    <img width="800" alt="image" src="https://user-images.githubusercontent.com/4663918/178540643-ea54452b-f9e6-4d08-bcfc-44a5af5ba0b3.png">
</a>

## Multiple doors
This is a more advanced example showing multiple garage doors all using the rotary encoder.

```json
[{"id":"7b4a2c42db6452c9","type":"mqtt in","z":"6ba85b54.4eaccc","name":"","topic":"home/garage/+/status","qos":"2","datatype":"auto","broker":"a59c4793.670798","nl":false,"rap":true,"rh":0,"inputs":0,"x":500,"y":940,"wires":[["84a7a05fc1c8e6c5","b10f94644ac4a3b9"]]},{"id":"9792a0cef14de8bd","type":"change","z":"6ba85b54.4eaccc","name":"Obstruction","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"ObstructionDetected\":1}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":1000,"wires":[["9d7c6d483dc27eec","472baaca270ae9ed","e6d33016a2a51c55"]]},{"id":"28180d22a4760e7a","type":"change","z":"6ba85b54.4eaccc","name":"Clear","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"ObstructionDetected\":0}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":970,"y":1040,"wires":[["9d7c6d483dc27eec","472baaca270ae9ed","e6d33016a2a51c55"]]},{"id":"84a7a05fc1c8e6c5","type":"switch","z":"6ba85b54.4eaccc","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"opening","vt":"str"},{"t":"eq","v":"open","vt":"str"},{"t":"eq","v":"closing","vt":"str"},{"t":"eq","v":"closed","vt":"str"},{"t":"eq","v":"reed_open","vt":"str"},{"t":"eq","v":"obstructed","vt":"str"},{"t":"eq","v":"clear","vt":"str"},{"t":"eq","v":"offline","vt":"str"},{"t":"eq","v":"online","vt":"str"}],"checkall":"true","repair":false,"outputs":9,"x":770,"y":940,"wires":[["63011314e44cc5c2"],["f2ea1d8c3f1648d2"],["c13d7b743accb5b3"],["b958cff80596dcd3"],["b958cff80596dcd3"],["9792a0cef14de8bd"],["28180d22a4760e7a"],[],[]]},{"id":"f2ea1d8c3f1648d2","type":"change","z":"6ba85b54.4eaccc","name":"CurrentDoorState Open","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"TargetDoorState\":0,\"CurrentDoorState\":0}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":880,"wires":[["9d7c6d483dc27eec","472baaca270ae9ed","e6d33016a2a51c55"]]},{"id":"b958cff80596dcd3","type":"change","z":"6ba85b54.4eaccc","name":"CurrentDoorState Closed","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"TargetDoorState\":1,\"CurrentDoorState\":1}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":960,"wires":[["9d7c6d483dc27eec","472baaca270ae9ed","e6d33016a2a51c55"]]},{"id":"63011314e44cc5c2","type":"change","z":"6ba85b54.4eaccc","name":"CurrentDoorState Opening","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"TargetDoorState\":0,\"CurrentDoorState\":2}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":840,"wires":[["9d7c6d483dc27eec","472baaca270ae9ed","e6d33016a2a51c55"]]},{"id":"c13d7b743accb5b3","type":"change","z":"6ba85b54.4eaccc","name":"CurrentDoorState Closing","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"TargetDoorState\":1,\"CurrentDoorState\":3}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":920,"wires":[["9d7c6d483dc27eec","472baaca270ae9ed","e6d33016a2a51c55"]]},{"id":"0c5169ea3fe86362","type":"inject","z":"6ba85b54.4eaccc","name":"GlassDoor closed","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"home/garage/M3Door/status","payload":"closed","payloadType":"str","x":490,"y":1000,"wires":[["84a7a05fc1c8e6c5"]]},{"id":"79db4dce343ba3c3","type":"inject","z":"6ba85b54.4eaccc","name":"GlassDoor obstructed","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"home/garage/GlassDoor/status","payload":"obstructed","payloadType":"str","x":480,"y":1040,"wires":[["84a7a05fc1c8e6c5"]]},{"id":"0271cc2419a53689","type":"inject","z":"6ba85b54.4eaccc","name":"GlassDoor open","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"home/garage/GlassDoor/status","payload":"open","payloadType":"str","x":500,"y":860,"wires":[["84a7a05fc1c8e6c5"]]},{"id":"822e192ee9995690","type":"inject","z":"6ba85b54.4eaccc","name":"GlassDoor closing","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"home/garage/GlassDoor/status","payload":"closing","payloadType":"str","x":490,"y":900,"wires":[["84a7a05fc1c8e6c5"]]},{"id":"14260601726ad0a9","type":"inject","z":"6ba85b54.4eaccc","name":"GlassDoor opening","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"home/garage/GlassDoor/status","payload":"opening","payloadType":"str","x":490,"y":820,"wires":[["84a7a05fc1c8e6c5"]]},{"id":"b4b301b468b3bfc8","type":"inject","z":"6ba85b54.4eaccc","name":"GlassDoor clear","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"home/garage/GlassDoor/status","payload":"clear","payloadType":"str","x":500,"y":1080,"wires":[["84a7a05fc1c8e6c5"]]},{"id":"cbd44e13318a1fea","type":"mqtt out","z":"6ba85b54.4eaccc","name":"home/garage/*/command","topic":"","qos":"2","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"a59c4793.670798","x":2030,"y":960,"wires":[]},{"id":"b10f94644ac4a3b9","type":"debug","z":"6ba85b54.4eaccc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":750,"y":1060,"wires":[]},{"id":"9e96ba6dc5cc686c","type":"change","z":"6ba85b54.4eaccc","name":"close","rules":[{"t":"set","p":"payload","pt":"msg","to":"close","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1810,"y":920,"wires":[["cbd44e13318a1fea","86a502b28b5eb34d"]]},{"id":"cf939af3a766c5be","type":"change","z":"6ba85b54.4eaccc","name":"open","rules":[{"t":"set","p":"payload","pt":"msg","to":"open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1810,"y":960,"wires":[["cbd44e13318a1fea","86a502b28b5eb34d"]]},{"id":"86a502b28b5eb34d","type":"debug","z":"6ba85b54.4eaccc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1990,"y":920,"wires":[]},{"id":"9d7c6d483dc27eec","type":"homekit-service","z":"6ba85b54.4eaccc","isParent":true,"hostType":"0","bridge":"5848fa57.3c3164","accessoryId":"","parentService":"","name":"Glass Door","serviceName":"GarageDoorOpener","topic":"home/garage/GlassDoor/status","filter":true,"manufacturer":"prw","model":"1337","serialNo":"001","firmwareRev":"1337","hardwareRev":"1337","softwareRev":"1337","cameraConfigVideoProcessor":"ffmpeg","cameraConfigSource":"","cameraConfigStillImageSource":"","cameraConfigMaxStreams":2,"cameraConfigMaxWidth":1280,"cameraConfigMaxHeight":720,"cameraConfigMaxFPS":10,"cameraConfigMaxBitrate":300,"cameraConfigVideoCodec":"libx264","cameraConfigAudioCodec":"libfdk_aac","cameraConfigAudio":false,"cameraConfigPacketSize":1316,"cameraConfigVerticalFlip":false,"cameraConfigHorizontalFlip":false,"cameraConfigMapVideo":"0:0","cameraConfigMapAudio":"0:1","cameraConfigVideoFilter":"scale=1280:720","cameraConfigAdditionalCommandLine":"-tune zerolatency","cameraConfigDebug":false,"cameraConfigSnapshotOutput":"disabled","cameraConfigInterfaceName":"","characteristicProperties":"{}","waitForSetupMsg":false,"outputs":2,"x":1330,"y":840,"wires":[["f30432e055d269d5"],[]]},{"id":"a4a19801141494eb","type":"switch","z":"6ba85b54.4eaccc","name":"","property":"payload.TargetDoorState","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1690,"y":940,"wires":[["9e96ba6dc5cc686c"],["cf939af3a766c5be"]]},{"id":"fc34255d73b16421","type":"inject","z":"6ba85b54.4eaccc","name":"Toggle Glass Door Light","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"home/garage/GlassDoor/command","payload":"light","payloadType":"str","x":1750,"y":1000,"wires":[["cbd44e13318a1fea"]]},{"id":"472baaca270ae9ed","type":"homekit-service","z":"6ba85b54.4eaccc","isParent":true,"hostType":"0","bridge":"5848fa57.3c3164","accessoryId":"","parentService":"","name":"M3 Door","serviceName":"GarageDoorOpener","topic":"home/garage/M3Door/status","filter":true,"manufacturer":"prw","model":"1337","serialNo":"001","firmwareRev":"1337","hardwareRev":"1337","softwareRev":"1337","cameraConfigVideoProcessor":"ffmpeg","cameraConfigSource":"","cameraConfigStillImageSource":"","cameraConfigMaxStreams":2,"cameraConfigMaxWidth":1280,"cameraConfigMaxHeight":720,"cameraConfigMaxFPS":10,"cameraConfigMaxBitrate":300,"cameraConfigVideoCodec":"libx264","cameraConfigAudioCodec":"libfdk_aac","cameraConfigAudio":false,"cameraConfigPacketSize":1316,"cameraConfigVerticalFlip":false,"cameraConfigHorizontalFlip":false,"cameraConfigMapVideo":"0:0","cameraConfigMapAudio":"0:1","cameraConfigVideoFilter":"scale=1280:720","cameraConfigAdditionalCommandLine":"-tune zerolatency","cameraConfigDebug":false,"cameraConfigSnapshotOutput":"disabled","cameraConfigInterfaceName":"","characteristicProperties":"{}","waitForSetupMsg":false,"outputs":2,"x":1340,"y":940,"wires":[["f30432e055d269d5"],[]]},{"id":"e6d33016a2a51c55","type":"homekit-service","z":"6ba85b54.4eaccc","isParent":true,"hostType":"0","bridge":"5848fa57.3c3164","accessoryId":"","parentService":"","name":"AMG Door","serviceName":"GarageDoorOpener","topic":"home/garage/AMGDoor/status","filter":true,"manufacturer":"prw","model":"1337","serialNo":"001","firmwareRev":"1337","hardwareRev":"1337","softwareRev":"1337","cameraConfigVideoProcessor":"ffmpeg","cameraConfigSource":"","cameraConfigStillImageSource":"","cameraConfigMaxStreams":2,"cameraConfigMaxWidth":1280,"cameraConfigMaxHeight":720,"cameraConfigMaxFPS":10,"cameraConfigMaxBitrate":300,"cameraConfigVideoCodec":"libx264","cameraConfigAudioCodec":"libfdk_aac","cameraConfigAudio":false,"cameraConfigPacketSize":1316,"cameraConfigVerticalFlip":false,"cameraConfigHorizontalFlip":false,"cameraConfigMapVideo":"0:0","cameraConfigMapAudio":"0:1","cameraConfigVideoFilter":"scale=1280:720","cameraConfigAdditionalCommandLine":"-tune zerolatency","cameraConfigDebug":false,"cameraConfigSnapshotOutput":"disabled","cameraConfigInterfaceName":"","characteristicProperties":"{}","waitForSetupMsg":false,"outputs":2,"x":1330,"y":1060,"wires":[["f30432e055d269d5"],[]]},{"id":"f30432e055d269d5","type":"change","z":"6ba85b54.4eaccc","name":"","rules":[{"t":"change","p":"topic","pt":"msg","from":"/status$","fromt":"re","to":"/command","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1530,"y":940,"wires":[["a4a19801141494eb"]]},{"id":"06f03b6dc2dc0bd1","type":"inject","z":"6ba85b54.4eaccc","name":"Query on Startup","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"query","payloadType":"str","x":490,"y":740,"wires":[["df251382102c6c94","aafbdfb73a0213ee","d84b0f13c55def9f"]]},{"id":"df251382102c6c94","type":"mqtt out","z":"6ba85b54.4eaccc","name":"","topic":"home/garage/GlassDoor/command","qos":"2","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"a59c4793.670798","x":780,"y":700,"wires":[]},{"id":"aafbdfb73a0213ee","type":"mqtt out","z":"6ba85b54.4eaccc","name":"","topic":"home/garage/AMGDoor/command","qos":"2","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"a59c4793.670798","x":770,"y":740,"wires":[]},{"id":"d84b0f13c55def9f","type":"mqtt out","z":"6ba85b54.4eaccc","name":"","topic":"home/garage/M3Door/command","qos":"2","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"a59c4793.670798","x":780,"y":780,"wires":[]},{"id":"a59c4793.670798","type":"mqtt-broker","name":"","broker":"10.0.1.55","port":"1883","clientid":"","autoConnect":true,"usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","birthMsg":{},"closeTopic":"","closeRetain":"false","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willRetain":"false","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"5848fa57.3c3164","type":"homekit-bridge","bridgeName":"NodeRed","pinCode":"111-11-112","port":"","allowInsecureRequest":false,"manufacturer":"NRCHKB","model":"1.2.0","serialNo":"Default Serial Number","firmwareRev":"1.2.0","hardwareRev":"1.2.0","softwareRev":"1.2.0","customMdnsConfig":false,"mdnsMulticast":true,"mdnsInterface":"","mdnsPort":"","mdnsIp":"","mdnsTtl":"","mdnsLoopback":true,"mdnsReuseAddr":true,"allowMessagePassthrough":false}]
```

<a href="https://user-images.githubusercontent.com/4663918/178541446-c6729560-5b7c-4244-96c0-bcd71e9c9b87.png">
  <img width="800" alt="image" src="https://user-images.githubusercontent.com/4663918/178541446-c6729560-5b7c-4244-96c0-bcd71e9c9b87.png">
</a>
